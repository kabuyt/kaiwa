<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" href="icon.png">
    <title>ãƒˆãƒãƒˆ ã‹ã„ã‚ N5</title>
    <style>
        body {
            font-family: 'Hiragino Kaku Gothic ProN', Arial, sans-serif;
            background-color: #7494C0; /* LINEã£ã½ã„èƒŒæ™¯è‰² */
            margin: 0; padding: 0;
            display: flex; flex-direction: column; height: 100vh;
            user-select: none;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        header {
            background: #2c3e50; color: white; padding: 15px; text-align: center;
            font-weight: bold; position: fixed; top: 0; width: 100%; z-index: 10;
            font-size: 18px;
        }

        /* ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ */
        #chat-area {
            flex: 1; margin-top: 60px; margin-bottom: 240px; padding: 15px;
            overflow-y: auto; display: flex; flex-direction: column; gap: 15px;
        }

        /* å¹ãå‡ºã—ï¼ˆç›¸æ‰‹ï¼‰ */
        .bubble-left {
            align-self: flex-start; background: white; padding: 12px 16px;
            border-radius: 15px; border-top-left-radius: 2px;
            max-width: 80%; position: relative;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            font-size: 16px; line-height: 1.4;
        }
        .bubble-left::before {
            content: "ãŸãªã‹ ã•ã‚“ (ä¸Šå¸)"; position: absolute; top: -20px; left: 0;
            font-size: 11px; color: white;
        }

        /* å¹ãå‡ºã—ï¼ˆè‡ªåˆ†ï¼‰ */
        .bubble-right {
            align-self: flex-end; background: #85E249; padding: 12px 16px;
            border-radius: 15px; border-top-right-radius: 2px;
            max-width: 80%;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            animation: popIn 0.3s;
            font-size: 16px; line-height: 1.4;
        }

        /* æ“ä½œã‚¨ãƒªã‚¢ */
        #control-area {
            position: fixed; bottom: 0; width: 100%;
            background: #eee; padding: 15px; box-sizing: border-box;
            border-top: 1px solid #ccc;
            height: 240px; /* å›ºå®šé«˜ã• */
            display: flex; flex-direction: column;
        }

        .situation-text {
            font-size: 14px; color: #555; margin-bottom: 8px; text-align: center;
            background: #fff; padding: 5px; border-radius: 5px;
            border: 1px solid #ccc;
        }

        #choices-container {
            flex: 1; overflow-y: auto; /* é¸æŠè‚¢ãŒå¤šã„æ™‚ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
        }

        .choice-btn {
            display: block; width: 100%; padding: 12px; margin-bottom: 8px;
            background: white; border: 2px solid #ddd; border-radius: 10px;
            font-size: 16px; font-weight: bold; color: #333; text-align: left;
            cursor: pointer;
        }
        .choice-btn:active { background: #EF5350; color: white; border-color: #EF5350; }

        /* æ¬¡ã¸ãƒœã‚¿ãƒ³ */
        #next-btn {
            display: none; width: 100%; padding: 15px;
            background: #EF5350; color: white; border: none; border-radius: 10px;
            font-size: 18px; font-weight: bold; margin-top: 10px;
        }

        @keyframes popIn { 0% { transform: scale(0); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <header>ã‹ã„ã‚ ã® ã‚Œã‚“ã—ã‚…ã†</header>

    <div id="chat-area">
        </div>

    <div id="control-area">
        <div id="situation" class="situation-text"></div>
        <div id="choices-container"></div>
        <button id="next-btn" onclick="nextScene()">ã¤ãã¸ (Tiáº¿p theo)</button>
    </div>

    <script>
        // â˜… ã‚·ãƒŠãƒªã‚ªãƒ‡ãƒ¼ã‚¿ï¼ˆã™ã¹ã¦ã²ã‚‰ãŒãªãƒ»ã‚«ã‚¿ã‚«ãƒŠ + ã‚¹ãƒšãƒ¼ã‚¹ï¼‰
        const scenarios = [
            {
                id: 1,
                situation: "ã‚ã•ã€ã“ã†ã˜ã‚‡ã†ã« ã¤ãã¾ã—ãŸã€‚ ãŸãªã‹ã•ã‚“ãŒ ã„ã¾ã™ã€‚",
                manager_say: "ãŠã¯ã‚ˆã†ã€‚ ã¯ã‚„ã„ã­ã€‚",
                manager_audio: "ãŠã¯ã‚ˆã†ã€‚ã¯ã‚„ã„ã­ã€‚",
                choices: [
                    { text: "ãŠã¯ã‚ˆã† ã”ã–ã„ã¾ã™ã€‚", score: 10, feedback: "â­•ï¸ ã„ã„ ã‚ã„ã•ã¤ ã§ã™ï¼" },
                    { text: "ãŠã¯ã‚ˆã†ã€‚", score: 0, feedback: "âŒ ã¨ã‚‚ã ã¡ã˜ã‚ƒ ãªã„ã§ã™ã€‚ã€Œã”ã–ã„ã¾ã™ã€ã‚’ ã¤ã‘ã¾ã—ã‚‡ã†ã€‚" },
                    { text: "ã“ã‚“ã«ã¡ã¯ã€‚", score: 5, feedback: "ğŸ”º ã‚ã•ã¯ ã€ŒãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€ ã§ã™ã€‚" }
                ]
            },
            {
                id: 2,
                situation: "ã—ã”ã¨ã¡ã‚…ã†ã€ ãŸãªã‹ã•ã‚“ãŒ ã¯ã‚„ãã¡ã§ ã¯ãªã—ã¾ã—ãŸã€‚",
                manager_say: "ã“ã‚Œã¨ ã‚ã‚Œã‚’ ã•ãã« ã‚„ã£ã¨ã„ã¦ï¼ï¼ˆã¯ã‚„ãã¡ï¼‰",
                manager_audio: "ã“ã‚Œã¨ã‚ã‚Œã‚’ã•ãã«ã‚„ã£ã¨ã„ã¦ï¼",
                choices: [
                    { text: "ã¯ã„ã€ã‚ã‹ã‚Šã¾ã—ãŸã€‚ï¼ˆã‚ã‹ã£ã¦ã„ãªã„ï¼‰", score: 0, feedback: "âŒ ãã‘ã‚“ã§ã™ï¼ ã‚ã‹ã‚‰ãªã„ã¨ãã¯ ããã¾ã—ã‚‡ã†ã€‚" },
                    { text: "ã™ã¿ã¾ã›ã‚“ã€ã‚‚ã†ã„ã¡ã© ãŠã­ãŒã„ã—ã¾ã™ã€‚", score: 10, feedback: "â­•ï¸ ã™ã°ã‚‰ã—ã„ï¼ ã‚ã‹ã‚‹ã¾ã§ ããã®ãŒ æ­£ã—ã„ã§ã™ã€‚" },
                    { text: "ãˆï¼Ÿ", score: 2, feedback: "ğŸ”º ã—ã¤ã‚Œã„ã§ã™ã€‚ã€Œã™ã¿ã¾ã›ã‚“ã€ã¨ ã„ã„ã¾ã—ã‚‡ã†ã€‚" }
                ]
            },
            {
                id: 3,
                situation: "ã‚ã—ãŸã€ ã³ã‚‡ã†ã„ã‚“ã¸ ã„ããŸã„ã§ã™ã€‚",
                manager_say: "ã‚ã—ãŸã® ã—ã”ã¨ã® ã“ã¨ã ã‘ã©â€¦",
                manager_audio: "ã‚ã—ãŸã®ã—ã”ã¨ã®ã“ã¨ã ã‘ã©â€¦",
                choices: [
                    { text: "ã‚ã—ãŸ ã³ã‚‡ã†ã„ã‚“ã§ã™ã€‚", score: 5, feedback: "ğŸ”º ã€Œã³ã‚‡ã†ã„ã‚“ãŒ ã©ã†ã—ãŸã®ï¼Ÿã€ã¨ ãŠã‚‚ã‚ã‚Œã¾ã™ã€‚" },
                    { text: "ã‚ã—ãŸ ã‚„ã™ã¿ã¾ã™ã€‚", score: 5, feedback: "ğŸ”º ã‚Šã‚†ã†ï¼ˆãªã‚“ã§ï¼Ÿï¼‰ã‚’ ã„ã„ã¾ã—ã‚‡ã†ã€‚" },
                    { text: "ã™ã¿ã¾ã›ã‚“ã€‚ã‚ã—ãŸ ã³ã‚‡ã†ã„ã‚“ã¸ ã„ããŸã„ã‚“ã§ã™ãŒâ€¦", score: 10, feedback: "â­•ï¸ ã‹ã‚“ãºãã§ã™ï¼ ã€Œã€œã‚“ã§ã™ãŒã€ã¯ ã¹ã‚“ã‚Šã§ã™ã€‚" }
                ]
            },
            {
                id: 4,
                situation: "ã‚³ãƒ³ãƒ“ãƒ‹ã§ ã‹ã„ã‚‚ã®ã‚’ ã—ã¦ã„ã¾ã™ã€‚",
                manager_say: "ãµãã‚ã¯ ã”ã‚Šã‚ˆã†ã§ã™ã‹ï¼Ÿï¼ˆã„ã‚Šã¾ã™ã‹ï¼Ÿï¼‰",
                manager_audio: "ãµãã‚ã¯ ã”ã‚Šã‚ˆã†ã§ã™ã‹ï¼Ÿ",
                choices: [
                    { text: "ã¯ã„ã€ãŠã­ãŒã„ã—ã¾ã™ã€‚", score: 10, feedback: "â­•ï¸ ã»ã—ã„ã¨ãã¯ ã“ã† ã„ã„ã¾ã™ã€‚" },
                    { text: "ã„ã‚‰ãªã„ã€‚", score: 2, feedback: "ğŸ”º ã¡ã‚‡ã£ã¨ ã“ã‚ã„ã§ã™ã€‚ã€Œã‘ã£ã“ã†ã§ã™ã€ã¨ ã„ã„ã¾ã—ã‚‡ã†ã€‚" },
                    { text: "ã‘ã£ã“ã†ã§ã™ã€‚ï¼ˆã„ã‚Šã¾ã›ã‚“ï¼‰", score: 10, feedback: "â­•ï¸ ã„ã‚‰ãªã„ã¨ãã¯ ã€Œã‘ã£ã“ã†ã§ã™ã€ãŒ ã„ã„ã§ã™ã€‚" }
                ]
            }
        ];

        let currentSceneIndex = 0;

        window.onload = loadScene;

        function loadScene() {
            if (currentSceneIndex >= scenarios.length) {
                // çµ‚äº†ç”»é¢
                document.getElementById('chat-area').innerHTML += `
                    <div style="text-align:center; margin-top:20px;">
                        <h2>ãŠã¤ã‹ã‚Œã•ã¾ï¼ğŸ‰</h2>
                        <p>ãœã‚“ã¶ ãŠã‚ã‚Šã¾ã—ãŸã€‚</p>
                        <button onclick="location.reload()" style="padding:10px 20px; font-size:16px;">ã‚‚ã†ã„ã¡ã©</button>
                    </div>
                `;
                document.getElementById('control-area').style.display = 'none';
                return;
            }

            const data = scenarios[currentSceneIndex];
            const chatArea = document.getElementById('chat-area');
            const choicesContainer = document.getElementById('choices-container');
            const nextBtn = document.getElementById('next-btn');
            const situation = document.getElementById('situation');

            // ãƒªã‚»ãƒƒãƒˆ
            if (currentSceneIndex === 0) chatArea.innerHTML = ""; // æœ€åˆã ã‘ã‚¯ãƒªã‚¢
            choicesContainer.style.display = "block";
            nextBtn.style.display = "none";
            situation.innerText = "ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³: " + data.situation;

            // 1. å°‘ã—å¾…ã£ã¦ã‹ã‚‰ç›¸æ‰‹ãŒè©±ã™
            setTimeout(() => {
                addBubble(data.manager_say, "left");
                speak(data.manager_audio);
            }, 600);

            // 2. é¸æŠè‚¢ã‚’è¡¨ç¤º
            choicesContainer.innerHTML = "";
            data.choices.forEach(choice => {
                let btn = document.createElement("button");
                btn.className = "choice-btn";
                btn.innerText = choice.text;
                btn.onclick = () => makeChoice(choice);
                choicesContainer.appendChild(btn);
            });
        }

        function addBubble(text, side) {
            const chatArea = document.getElementById('chat-area');
            const div = document.createElement("div");
            div.className = side === "left" ? "bubble-left" : "bubble-right";
            div.innerText = text;
            chatArea.appendChild(div);
            // è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            setTimeout(() => {
                chatArea.scrollTop = chatArea.scrollHeight; 
            }, 100);
        }

        function makeChoice(choice) {
            // è‡ªåˆ†ã®ç™ºè¨€ã‚’è¡¨ç¤º
            addBubble(choice.text, "right");
            speak(choice.text); // è‡ªåˆ†ã‚‚ç™ºéŸ³ã—ã¦ã¿ã‚‹

            // é¸æŠè‚¢ã‚’æ¶ˆã™
            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = "";
            
            // ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆä¸Šå¸ã‹ã‚‰ã®è¿”ä¿¡é¢¨ï¼‰
            setTimeout(() => {
                addBubble(choice.feedback, "left");
                
                // æ¬¡ã¸ãƒœã‚¿ãƒ³è¡¨ç¤º
                document.getElementById('next-btn').style.display = "block";
            }, 1000);
        }

        function nextScene() {
            currentSceneIndex++;
            loadScene();
        }

        function speak(text) {
            window.speechSynthesis.cancel();
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            uttr.rate = 1.0;
            window.speechSynthesis.speak(uttr);
        }
    </script>
</body>
</html>